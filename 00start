#!/system/bin/sh
#
# W.I.P. script, by USBhost.
#
# I use busybox for some commands because
# in the hopes of them being newer.
#
# The 'FI.d' folder
# is meant for values that do not stay at boot

# Load Symbols
	. /system/etc/FI.d/symbols

# Script pacific Symbols
	LC="00start"

# Wake lock is needed because if the system suspends
# FI.d/init.d scripts will not run.
	echo tmp_lock > /sys/power/wake_lock && $LOGCATI$LC " FI.d start v42"
	$LOGCATI$LC "$(id)"

# Mount cache
	if [ ! -e "$CMOUNT" ]; then 
		$BB mount -t ext4 -o rw,nobarrier,noload,errors=continue $CACHE /cache && touch $CMOUNT ||
        	$BB mount -t auto -o rw $CACHE /cache && touch $CMOUNT
		if [ ! -e "$CMOUNT" ]; then 
        		$LOGCATI$LC " cache; mount failed "
		elif [ -e "$CMOUNT" ]; then 
			$LOGCATI$LC " cache; mount successful "
			$BB fstrim /cache
		fi
	else
		$LOGCATI$LC " cache; is already mounted "
	fi

# Start init.d
	if [ ! -e /system/bin/sysinit ]; then
		$BB run-parts /system/etc/init.d
	fi

# Wait to continue
	$LOGCATI$LC " 1min 30sec wait to continue "
	$BB sleep 1m 30s
